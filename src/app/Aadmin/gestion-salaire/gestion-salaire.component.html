<div class="container mt-4">
  <h1 class="mb-4"><b>Statistiques des Employés</b></h1>

  <div *ngIf="isLoadingS" class="text-center">
    <div class="spinner-border" role="status">
      <span class="sr-only"></span>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <div *ngIf="statistics" class="row">
    <div class="col-md-3">
      <div class="card card-custom bg-primary text-white mb-3">
        <div class="card-header text-white">
          <i class="bi bi-people-fill card-icon" style="color: blue;"></i>
          <span style="color: #0b0b0b;"> Nombre Total d'Employés</span>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ statistics.totalEmployees }}</h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-custom bg-success text-white mb-3">
        <div class="card-header text-white">
          <i class="bi bi-currency-dollar card-icon" style="color: #165902;"></i>
          <span style="color: #0b0b0b;">  Total des Salaires Payés</span>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ statistics.totalPaidSalaries | currency }}</h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-custom bg-danger text-white mb-3">
        <div class="card-header text-white">
          <i class="bi bi-exclamation-triangle-fill card-icon" style="color: #ed2f40;"></i>
          <span style="color: #0b0b0b;">   Total des Salaires Non Payés</span>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ statistics.totalUnpaidSalaries | currency }}</h5>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card card-custom bg-info text-white mb-3">
        <div class="card-header text-white">
          <i class="bi bi-calendar-check-fill card-icon" style="color: #7a9ff0;"></i>
          <span style="color: #0b0b0b;">   Total des Jours Travaillés</span>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ statistics.totalDaysWorked }}</h5>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div *ngIf="notification" class="notification alert alert-{{ notification.type }}" role="alert">
    {{ notification.message }}
  </div>

  <div class="card mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h1>Liste des Agents</h1>
      <div>
        <button class="btn btn-primary" (click)="exportToExcel()">Exporter en Excel</button>
      </div>
      <div class="input-group w-25">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span>
        </div>
        <input type="text" class="form-control" [(ngModel)]="searchQuery" (ngModelChange)="onSearchQueryChange($event)" placeholder="Rechercher...">
      </div>
    </div>
    <div class="card-body">
      <table class="table table-striped table-bordered">
        <thead  >
        <tr>
          <th>Agent</th>
          <th>Salaire Net</th>
          <th>Salaire par Jour</th>
          <th>Nombre de Jours Présents</th>
          <th>Prime</th>
          <th>Statut de Paiement</th>
          <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let employee of filteredEmployees">
          <td class="d-flex align-items-center">
            <img [src]="employee.image ? 'data:image/jpeg;base64,' + employee.image : 'https://bootdey.com/img/Content/avatar/avatar7.png'" alt="{{ employee.nom }}" class="rounded-circle me-2" width="40" height="40">
            <div>{{ employee.nom }} {{ employee.prenom }}</div>
          </td>
          <td>{{ employee.salaireNet | currency }}</td>
          <td>{{ employee.salaireParJour | currency }}</td>
          <td>{{ employee.nmbreDeJour }}</td>
          <td>{{ employee.prime | currency}}</td>
          <td>{{ employee.paymentStatus }}</td>
          <td>
            <button *ngIf="employee.paymentStatus === 'UNPAID'" (click)="confirmPayment(employee.id)" class="btn btn-success" [disabled]="isLoading[employee.id]">
              <span *ngIf="!isLoading[employee.id]">Confirmer Paiement</span>
              <span *ngIf="isLoading[employee.id]" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            </button>
            <span *ngIf="employee.paymentStatus === 'PAID'" class="text-success">Payé</span>
          </td>
        </tr>
        </tbody>
      </table>
      <div class="d-flex justify-content-between align-items-center mt-3">
        <button class="btn btn-secondary" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">Précédent</button>
        <span>Page {{ currentPage }} sur {{ totalPages() }}</span>
        <button class="btn btn-secondary" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage * itemsPerPage >= totalItems">Suivant</button>
      </div>
    </div>
  </div>
</div>
